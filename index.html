<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Birthday Surprise — Deliska</title>
    <style>
        :root {
            --page-bg: #ffffff;
            --text: #0b1220;
            --accent: #ff6b81;
            --muted: #64748b;
            --card-bg: #ffffff;
            --glass: rgba(255,255,255,0.6);
            --card-shadow: 0 10px 30px rgba(15,23,42,0.08);
        }

        /* Reset and layout */
        html, body {
            height: 100%;
            margin: 0;
            font-family: Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;
            background: var(--page-bg);
            color: var(--text)
        }

        button {
            font-family: inherit
        }

        /* Center stage */
        .stage {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 18px;
            padding: 36px
        }

        .hint {
            font-size: 1.05rem;
            color: var(--muted)
        }

        /* Present */
        .present {
            width: 220px;
            height: 220px;
            position: relative;
            perspective: 1000px;
            cursor: pointer;
            transform-style: preserve-3d;
            pointer-events: auto;
            z-index: 100;
        }

            .present .box {
                width: 100%;
                height: 100%;
                background: linear-gradient(180deg,#ff9fb4,#d94b6f);
                border-radius: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 18px 60px rgba(15,23,42,0.12);
                transform-origin: center bottom;
                transition: transform .9s cubic-bezier(.2,.9,.2,1)
            }

        .ribbon-vertical {
            position: absolute;
            left: calc(50% - 20px);
            top: 0;
            width: 44px;
            height: 100%;
            background: linear-gradient(180deg,#fff1cc,#ffd1a3);
            border-radius: 10px
        }

        .ribbon-horizontal {
            position: absolute;
            top: calc(50% - 22px);
            left: 0;
            height: 44px;
            width: 100%;
            background: linear-gradient(90deg,#fff1cc,#ffd1a3);
            border-radius: 10px
        }

        .lid {
            position: absolute;
            top: -26px;
            left: 0;
            width: 100%;
            height: 68px;
            background: linear-gradient(180deg,#ff7a9e,#d94b6f);
            border-radius: 16px;
            transform-origin: center right;
            box-shadow: 0 8px 20px rgba(0,0,0,.08);
            transition: transform .9s cubic-bezier(.2,.9,.2,1)
        }

        .present.opened .lid {
            transform: rotateX(72deg) translateY(-12px) translateZ(12px)
        }

        .present.opened .box {
            transform: translateY(18px) scale(0.98)
        }

        /* Fullscreen layout without a panel background */
        main.app {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            gap: 18px;
            padding: 28px;
            align-items: center
        }

        .topbar {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .big-title {
            font-size: 2.4rem;
            font-weight: 800;
            color: var(--accent);
            text-align: center
        }

        /* Center slideshow */
        .center-stage {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 18px;
            flex: 1;
            width: 100%;
            max-width: 1100px
        }

        .photo-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 10px;
            min-width: 480px;
            max-width: 820px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: var(--card-shadow)
        }

        .photo {
            width: 100%;
            height: 520px;
            border-radius: 12px;
            background-size: cover;
            background-position: center
        }

        .controls {
            margin-top: 12px;
            display: flex;
            gap: 10px;
            align-items: center;
            width: 100%
        }

        .btn {
            background: transparent;
            border: 1px solid rgba(8,12,20,0.06);
            padding: 10px 14px;
            border-radius: 10px;
            color: var(--text);
            cursor: pointer;
            font-weight: 700
        }

        /* Side arrows for large-screen navigation */
        .side-btn {
            background: transparent;
            border: 0;
            font-size: 1.35rem;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer
        }

        /* Wishes area */
        .wishes-outer {
            width: 100%;
            max-width: 1100px;
            margin-top: 8px
        }

        .wishes-ctrl {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px
        }

        .wish-form {
            display: flex;
            gap: 10px;
            align-items: center
        }

        .input, textarea {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid rgba(11,17,32,0.06);
            outline: none
        }

        textarea {
            min-height: 56px;
            resize: vertical
        }

        .wishes {
            display: grid;
            grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
            gap: 14px
        }

        .wish {
            background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.9));
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(11,17,32,0.04);
            box-shadow: 0 8px 18px rgba(15,23,42,0.05)
        }

            .wish .who {
                font-weight: 800;
                color: var(--accent);
                margin-bottom: 8px
            }

        .placeholder {
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            color: var(--muted);
            border: 1px dashed rgba(11,17,32,0.06)
        }

        /* small screens tweaks */
        @media (max-width:860px) {
            .photo {
                height: 320px
            }

            .photo-card {
                min-width: 260px
            }

            .big-title {
                font-size: 1.6rem
            }

            .center-stage {
                padding: 0
            }
        }
    </style>
</head>
<body>
    <div class="stage" id="startStage">
        <div class="hint">Click the present to open 🎉</div>
        <div class="present" id="present" role="button" tabindex="0" aria-pressed="false" aria-label="Open present">
            <div class="lid"></div>
            <div class="ribbon-vertical"></div>
            <div class="ribbon-horizontal"></div>
            <div class="box"></div>
        </div>
    </div>

    <main class="app" id="app" style="display:none">
        <div class="topbar"><div class="big-title" id="bigTitle">Happy Birthday Deliska!</div></div>

        <div class="center-stage">
            <button class="side-btn btn" id="prevLarge" aria-label="Previous">◀</button>
            <div class="photo-card">
                <div class="photo" id="largePhoto" role="img" aria-label="Birthday photo"></div>
                <div class="controls">
                    <button class="btn" id="prev">Prev</button>
                    <div style="flex:1;text-align:center;font-weight:700" id="counter">0 / 0</div>
                    <button class="btn" id="next">Next</button>
                </div>
            </div>
            <button class="side-btn btn" id="nextLarge" aria-label="Next">▶</button>
        </div>

        <div class="wishes-outer">
            <div class="wishes-ctrl">
                <div class="wish-form">
                    <input class="input" id="nameInput" placeholder="Your name" />
                    <textarea id="wishInput" placeholder="Write a birthday wish..." class="input"></textarea>
                    <input type="file" id="photoInput" accept="image/*" />
                    <button class="btn" id="submitWish">Add Wish</button>
                </div>
                <div style="display:flex;gap:10px;align-items:center">
                    <div id="uploading" style="font-size:0.95rem;color:var(--muted);display:none">Uploading...</div>
                    <div id="songTitle">Happy Birthday — tune</div>
                    <button class="btn" id="toggleAudio">Play</button>
                </div>
            </div>

            <div id="wishes" class="wishes">
                <div class="placeholder" id="noWishes">No wishes yet — be the first to add a birthday wish!</div>
            </div>
        </div>

        <audio id="bgAudio" loop></audio>
    </main>

    <!-- Firebase (you must add your own config) -->
    <script type="module">
        // ----- CONFIGURATION -----
        // Replace the firebaseConfig below with your project's config (from the Firebase console).
        // Steps to create a free Firebase project and enable Firestore + Storage + Anonymous Auth:
        // 1) Go to https://console.firebase.google.com and create a new project.
        // 2) In "Authentication" → Sign-in method, enable Anonymous.
        // 3) In "Firestore Database" create a database in production or test mode (test is OK while developing).
        // 4) In "Storage" create a storage bucket (default created automatically).
        // 5) In Project Settings (gear) -> SDK Setup, copy the firebaseConfig object and paste below.

        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js';

        // --- REPLACE THIS ---
        const firebaseConfig = {

            apiKey: "AIzaSyBfE82nnDyIJRJWB0cDFb9oODRzJKuhKNU",

            authDomain: "birthday-surprise-3ef8d.firebaseapp.com",

            projectId: "birthday-surprise-3ef8d",

            storageBucket: "birthday-surprise-3ef8d.firebasestorage.app",

            messagingSenderId: "425863345219",

            appId: "1:425863345219:web:f5c6e1ca31e94c9ec2d0f6",

            measurementId: "G-HNK59ZQDER"

        };

        // ---------------------

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // anonymous signin for uploads
        signInAnonymously(auth).catch(() => {/* ignore for now */ });

        // DOM
        const startStage = document.getElementById('startStage');
        const present = document.getElementById('present');
        const appMain = document.getElementById('app');
        const largePhoto = document.getElementById('largePhoto');
        const counter = document.getElementById('counter');
        const prev = document.getElementById('prev');
        const next = document.getElementById('next');
        const prevLarge = document.getElementById('prevLarge');
        const nextLarge = document.getElementById('nextLarge');
        const wishesContainer = document.getElementById('wishes');
        const noWishes = document.getElementById('noWishes');
        const nameInput = document.getElementById('nameInput');
        const wishInput = document.getElementById('wishInput');
        const photoInput = document.getElementById('photoInput');
        const submitWish = document.getElementById('submitWish');
        const uploading = document.getElementById('uploading');
        const bgAudio = document.getElementById('bgAudio');
        const toggleAudio = document.getElementById('toggleAudio');

        // local arrays for photos (populated from Firestore 'photos' collection)
        let photos = [];
        let idx = 0;

        function updateLarge() {
            if (photos.length === 0) {
                largePhoto.style.backgroundImage = '';
                largePhoto.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--muted)">No photos yet — upload one!</div>';
                counter.textContent = '0 / 0';
                return;
            }
            largePhoto.innerHTML = '';
            largePhoto.style.backgroundImage = `url('${photos[idx].url}')`;
            counter.textContent = `${idx + 1} / ${photos.length}`;
        }

        prev.addEventListener('click', () => { if (photos.length) idx = (idx - 1 + photos.length) % photos.length; updateLarge(); });
        next.addEventListener('click', () => { if (photos.length) idx = (idx + 1) % photos.length; updateLarge(); });
        prevLarge.addEventListener('click', () => { if (photos.length) idx = (idx - 1 + photos.length) % photos.length; updateLarge(); });
        nextLarge.addEventListener('click', () => { if (photos.length) idx = (idx + 1) % photos.length; updateLarge(); });

        toggleAudio.addEventListener('click', () => { if (bgAudio.paused) { bgAudio.play(); toggleAudio.textContent = 'Pause'; } else { bgAudio.pause(); toggleAudio.textContent = 'Play'; } });

        // Listen for wishes in Firestore
        const wishesQ = query(collection(db, 'wishes'), orderBy('created', 'desc'));
        onSnapshot(wishesQ, snap => {
            const docs = [];
            wishesContainer.innerHTML = '';
            snap.forEach(d => { docs.push({ id: d.id, ...d.data() }); });
            if (docs.length === 0) { wishesContainer.appendChild(noWishes); noWishes.style.display = 'block'; }
            else {
                noWishes.style.display = 'none';
                docs.forEach(w => {
                    const el = document.createElement('div'); el.className = 'wish';
                    el.innerHTML = `<div class="who">${escapeHtml(w.name || 'Anonymous')}</div><div class="text">${escapeHtml(w.text)}</div>`;
                    if (w.photoURL) {
                        const img = document.createElement('img'); img.src = w.photoURL; img.style.width = '100%'; img.style.borderRadius = '8px'; img.style.marginTop = '8px';
                        el.appendChild(img);
                    }
                    wishesContainer.appendChild(el);
                });
            }
        });

        // Listen for photos collection
        const photosQ = query(collection(db, 'photos'), orderBy('created', 'desc'));
        onSnapshot(photosQ, snap => {
            photos = [];
            snap.forEach(d => { photos.push({ ...d.data(), id: d.id }); });
            if (photos.length) idx = 0;
            updateLarge();
        });

        // Submit wish (with optional image)
        submitWish.addEventListener('click', async () => {
            const name = nameInput.value.trim() || 'Anonymous';
            const text = wishInput.value.trim();
            const file = photoInput.files[0];
            if (!text && !file) { alert('Please enter a message or select a photo.'); return; }

            uploading.style.display = 'inline-block';
            submitWish.disabled = true;
            try {
                let photoURL = null;
                if (file) {
                    const fileRef = storageRef(storage, `uploads/${Date.now()}_${file.name}`);
                    await uploadBytes(fileRef, file);
                    photoURL = await getDownloadURL(fileRef);
                    // also add to photos collection so it appears in the slideshow
                    await addDoc(collection(db, 'photos'), { url: photoURL, created: serverTimestamp() });
                }
                await addDoc(collection(db, 'wishes'), { name, text, photoURL, created: serverTimestamp() });
                nameInput.value = ''; wishInput.value = ''; photoInput.value = '';
            } catch (e) {
                console.error(e); alert('Upload failed. Check console for details.');
            } finally {
                uploading.style.display = 'none'; submitWish.disabled = false;
            }
        });

        // small present animation -> reveal app
        function reveal() {
            startStage.style.display = 'none';
            app.style.display = 'flex';
        }

        // Instead of the simple reveal above, reuse existing present animation behavior
        // For brevity: clicking present will open, emit confetti and then show app
        present.addEventListener('click', () => {
            // open lid
            present.classList.add('opened');

            // simple confetti
            for (let i = 0; i < 80; i++) {
                const conf = document.createElement('div');
                conf.style.cssText = `
            position: fixed;
            left: ${50 + (Math.random() - 0.5) * 40}%;
            top: ${40 + Math.random() * 20}%;
            width: 10px; height: 12px;
            background: ${['#ffd1a3', '#ffb86b', '#ff7a9e', '#ffd9e3'][Math.floor(Math.random() * 4)]};
            border-radius: 2px;
            z-index: 1000;
            transition: transform 2s ease, top 2s ease, opacity 2s ease;
        `;
                document.body.appendChild(conf);
                setTimeout(() => {
                    conf.style.top = `${75 + Math.random() * 12}%`;
                    conf.style.opacity = '0';
                    conf.style.transform += ' translateY(40px) rotate(720deg)';
                }, 50 + Math.random() * 200);
                setTimeout(() => conf.remove(), 2500);
            }

            // animate present
            present.style.transition = 'transform 0.8s ease, opacity 0.8s ease';
            present.style.transform = 'scale(1.2) translateY(-50px)';
            present.style.opacity = '0';

            // reveal app
            setTimeout(() => {
                startStage.style.display = 'none';
                appMain.style.display = 'flex';
            }, 1200);
        });


        // simple helper to escape HTML
        function escapeHtml(str) { return String(str).replace(/[&<>"']/g, s => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#39;" }[s])); }

        // autoplay audio if available
        // leave src empty - you can place your audio path here or drop a file and set path
        bgAudio.src = 'birthdaysong.mp3';
        bgAudio.play().catch(()=>{});
    </script>
</body>
</html>
